name: Create release bundle
on:
  release:
    types: [published]

jobs:
  build:
    name: Create vendor bundle
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout sources
        uses: actions/checkout@v2
      - name: Install dependencies
        shell: bash
        run: |
          composer install --no-dev --no-suggest
          composer dumpautoload --no-dev --optimize
      - name: Create directory zip
        shell: bash
        run: |
          cd ..
          zip -r translate-bundle-${{ github.event.release.tag_name }}.zip TRANSLATE_MODULE/ -x "*.git*"
          mv translate-bundle-${{ github.event.release.tag_name }}.zip TRANSLATE_MODULE/
      - name: Upload Release Asset
        id: upload-release-asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ github.event.release.upload_url }}
          asset_path: ./translate-bundle-${{ github.event.release.tag_name }}.zip
          asset_name: translate-bundle-${{ github.event.release.tag_name }}.zip
          asset_content_type: application/zip
